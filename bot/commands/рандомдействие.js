const { SlashCommandBuilder } = require('discord.js');

const events = {
  ÑÐ¼ÐµÑˆÐ½Ñ‹Ðµ: [
    '{user} Ð½Ð°Ñ‡Ð°Ð» Ñ‚Ð°Ð½Ñ†ÐµÐ²Ð°Ñ‚ÑŒ ðŸ’ƒ',
    'Ð’ÑÐµ Ð½Ð°Ñ‡Ð°Ð»Ð¸ ÐºÑ€Ð¸Ñ‡Ð°Ñ‚ÑŒ ÐÐÐ¥ÐÐ¥ÐÐ¥Ð ðŸ˜‚',
    'Ð˜Ð´Ñ‘Ñ‚ Ð´Ð¾Ð¶Ð´ÑŒ Ð¸Ð· Ð¼ÐµÐ¼Ð¾Ð² ðŸŒ§ï¸',
    '{user} ÑƒÐ¿Ð°Ð» Ð¸ Ð²ÑÐµ ÑÐ¼ÐµÑŽÑ‚ÑÑ ðŸ¤£',
    '{user} ÑÐ´ÐµÐ»Ð°Ð» Ð¿Ñ€Ð¸ÐºÐ¾Ð»ÑŒÐ½Ñ‹Ð¹ Ñ‚Ð°Ð½ÐµÑ† Ð¸ Ð²Ñ‹Ð¸Ð³Ñ€Ð°Ð» Ð¿Ñ€Ð¸Ð· ðŸ†',
    'Ð‘Ð¾Ñ‚ Ð·Ð°Ð¸Ð³Ñ€Ð°Ð» Epic Sax Guy ðŸŽ·',
    '{user} ÐºÑ€ÑƒÑ‚Ð¸Ñ‚ÑÑ Ð²Ð¾Ð»Ñ‡ÐºÐ¾Ð¼ ðŸŒ€',
    'ÐŸÑ€Ð¾Ð¸Ð·Ð¾ÑˆÐ»Ð° Ð½ÐµÐ¾Ð¶Ð¸Ð´Ð°Ð½Ð½Ð°Ñ ÑÐ²Ð¾Ð»ÑŽÑ†Ð¸Ñ! ðŸ¦¶â†’ðŸ¦—',
    '{user} Ð´ÐµÐ»Ð°ÐµÑ‚ ÑÐ°Ð»Ñ‚Ð¾ (Ð½ÐµÑƒÐ´Ð°Ñ‡Ð½Ð¾) ðŸ¤¸',
    'Ð’ÑÐµ Ð½Ð°Ñ‡Ð°Ð»Ð¸ ÐµÑÑ‚ÑŒ Ð¿Ð¸Ñ†Ñ†Ñƒ ðŸ•',
    '{user} Ð²Ñ‹Ð¸Ð³Ñ€Ð°Ð» ÐºÐ¾Ð½ÐºÑƒÑ€Ñ ÐºÑ€Ð°ÑÐ¾Ñ‚Ñ‹ ðŸ‘‘',
    'Ð‘Ð¾Ñ‚ ÑÐ¼ÐµÑ…Ð¾Ð¼ ÑÐ»Ð¾Ð¼Ð°Ð»ÑÑ Ð¥ÐÐ¥ÐÐ¥ÐÐ¥ÐÐ¥Ð¥Ð ðŸ˜†',
    '{user} Ð·Ð°Ð±Ð°Ð²Ð½Ð¾ Ñ…Ð¾Ð´Ð¸Ñ‚ Ð²Ñ€Ð°Ð·Ð²Ð°Ð»ÐºÑƒ ðŸš¶'
  ],
  Ð³Ñ€ÑƒÑÑ‚Ð½Ñ‹Ðµ: [
    '{user} Ð·Ð°ÑÐ½ÑƒÐ» ðŸ˜´',
    '{user} ÑÐ¸Ð´Ð¸Ñ‚ Ð² ÑƒÐ³Ð»Ñƒ Ð¸ Ð³Ñ€ÑƒÑÑ‚Ð¸Ñ‚ ðŸ˜ž',
    'Ð’ÑÐµ Ð¼Ð¾Ð»Ñ‡Ð°Ñ‚... Ð¾Ñ‡ÐµÐ½ÑŒ Ð¼Ð¾Ð»Ñ‡Ð°Ñ‚... ðŸ¤',
    '{user} Ð¿Ð¾Ñ‚ÐµÑ€ÑÐ» ÑÐ²Ð¾Ð¹ Ð»ÑŽÐ±Ð¸Ð¼Ñ‹Ð¹ Ð¼ÐµÐ¼ ðŸ˜­',
    'ÐÐ°Ñ‡Ð°Ð»ÑÑ Ð´Ð¾Ð¶Ð´ÑŒ... Ð¾Ñ‡ÐµÐ½ÑŒ Ð³Ñ€ÑƒÑÑ‚Ð½Ñ‹Ð¹ Ð´Ð¾Ð¶Ð´ÑŒ ðŸŒ§ï¸ðŸ˜¢',
    '{user} Ð²ÑÐ¿Ð¾Ð¼Ð½Ð¸Ð» Ð¾ ÑÐ²Ð¾Ð¸Ñ… Ð¾ÑˆÐ¸Ð±ÐºÐ°Ñ… Ð² ÐºÐ¾Ð´Ðµ ðŸ’”',
    'Ð’ÑÐµ Ð·Ð°Ð±Ñ‹Ð»Ð¸ Ð¿Ñ€Ð¾ {user} ðŸ‘»',
    '{user} Ð¿Ð¾Ð½ÑÐ», Ñ‡Ñ‚Ð¾ JavaScript Ð½Ð¸ÐºÐ¾Ð³Ð´Ð° Ð½Ðµ Ð²Ñ‹ÑƒÑ‡Ð¸Ñ‚ ðŸ˜©'
  ],
  Ð·Ð»Ñ‹Ðµ: [
    '{user} Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ð» Ð‘ÐÐ Ð½Ð° 1 ÑÐµÐº! (ÑˆÑƒÑ‚ÐºÐ°) ðŸ”¨',
    'Ð’ÑÐµ Ð½Ð°Ñ‡Ð°Ð»Ð¸ Ð²Ð¾Ð·Ð¼ÑƒÑ‰Ð°Ñ‚ÑŒÑÑ! ðŸ˜¤',
    '{user} Ð¿Ð¾ÑÑÐ¾Ñ€Ð¸Ð»ÑÑ Ñ Ð±Ð¾Ñ‚Ð¾Ð¼ ðŸ‘¿',
    'ÐÐºÑ‚Ð¸Ð²Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð° Ð Ð•Ð–Ð˜Ðœ Ð¥ÐÐžÐ¡Ð! ðŸ”¥ðŸ’¥',
    '{user} Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ð» Ð¿Ñ€Ð¾ÐºÐ»ÑÑ‚Ð¸Ðµ Ð½ÐµÑƒÐ´Ð°Ñ‡Ð¸! â˜ ï¸',
    'Ð’ÑÐµ ÐºÑ€Ð¸Ñ‡Ð°Ñ‚ "Ð’Ð«ÐœÐ•Ð¢ÐÐ™Ð¡Ð¯!" Ð² {user} ðŸ—£ï¸',
    '{user} ÑƒÐ¿Ð°Ð» Ð² Ð»Ð°Ð²Ñƒ! ðŸŒ‹',
    'ÐÐ°Ñ‡Ð°Ð»ÑÑ Ð°Ð¿Ð¾ÐºÐ°Ð»Ð¸Ð¿ÑÐ¸Ñ! ðŸŒªï¸âš¡'
  ],
  Ð´Ñ€ÑƒÐ³Ð¸Ðµ: [
    '{user} ÑÑ‚Ð°Ð» Ð½ÐµÐ²Ð¸Ð´Ð¸Ð¼Ñ‹Ð¼ ðŸ‘»',
    'Ð’ÑÐµ Ð¿Ñ€ÐµÐ²Ñ€Ð°Ñ‚Ð¸Ð»Ð¸ÑÑŒ Ð² Ð¿Ð¸Ð½Ð³Ð²Ð¸Ð½Ð¾Ð²! ðŸ§',
    'Ð“Ñ€Ð°Ð²Ð¸Ñ‚Ð°Ñ†Ð¸Ñ ÑÐ»Ð¾Ð¼Ð°Ð»Ð°ÑÑŒ! {user} Ð»ÐµÑ‚Ð°ÐµÑ‚! ðŸš€',
    '{user} Ñ€Ð°Ð·Ð²Ð¸Ð» ÑÑƒÐ¿ÐµÑ€ ÑÐ¿Ð¾ÑÐ¾Ð±Ð½Ð¾ÑÑ‚Ð¸! âš¡ðŸ’ª',
    'Ð’ÑÐµ Ð½Ð°Ñ‡Ð°Ð»Ð¸ Ð³Ð¾Ð²Ð¾Ñ€Ð¸Ñ‚ÑŒ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¼ÐµÐ¼Ð°Ð¼Ð¸ ðŸŽ¬',
    '{user} Ð²Ñ‹Ð¸Ð³Ñ€Ð°Ð» Ð»Ð¾Ñ‚ÐµÑ€ÐµÑŽ! ðŸ’°ðŸŽ‰',
    'ÐŸÑ€Ð¾Ð¸Ð·Ð¾ÑˆÐ»Ð¾ Ð·ÐµÐ¼Ð»ÐµÑ‚Ñ€ÑÑÐµÐ½Ð¸Ðµ! ðŸŒ',
    '{user} Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ð» Ð¶Ð¸Ð·Ð½ÑŒ ÐºÐ¾Ñ‚Ð° (9 Ð¶Ð¸Ð·Ð½ÐµÐ¹) ðŸ±9ï¸âƒ£'
  ]
};

// ÐžÐ±ÑŠÐµÐ´Ð¸Ð½ÑÐµÐ¼ Ð²ÑÐµ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ Ð² Ð¾Ð´Ð¸Ð½ Ð¼Ð°ÑÑÐ¸Ð²
const allEvents = [
  ...events.ÑÐ¼ÐµÑˆÐ½Ñ‹Ðµ,
  ...events.Ð³Ñ€ÑƒÑÑ‚Ð½Ñ‹Ðµ,
  ...events.Ð·Ð»Ñ‹Ðµ,
  ...events.Ð´Ñ€ÑƒÐ³Ð¸Ðµ
];

function getRandomEvent(userName) {
  const randomEvent = allEvents[Math.floor(Math.random() * allEvents.length)];
  return randomEvent.replace('{user}', userName);
}

module.exports = {
  data: new SlashCommandBuilder()
    .setName('Ñ€Ð°Ð½Ð´Ð¾Ð¼Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ')
    .setDescription('ðŸŽ² Ð Ð°Ð½Ð´Ð¾Ð¼Ð½Ð¾Ðµ ÑÐ¼ÐµÑˆÐ½Ð¾Ðµ, Ð³Ñ€ÑƒÑÑ‚Ð½Ð¾Ðµ Ð¸Ð»Ð¸ Ð·Ð»Ð¾Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ Ð² Ñ‡Ð°Ñ‚Ðµ')
    .addUserOption(option =>
      option
        .setName('ÑŽÐ·ÐµÑ€')
        .setDescription('ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð´Ð»Ñ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ (ÐµÑÐ»Ð¸ Ð½Ðµ ÑƒÐºÐ°Ð·Ð°Ð½, ÑÐ»ÑƒÑ‡Ð°Ð¹Ð½Ñ‹Ð¹)')
        .setRequired(false)
    ),

  async execute(interaction) {
    try {
      let targetUser;
      
      // Ð•ÑÐ»Ð¸ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ ÑƒÐºÐ°Ð·Ð°Ð½, Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ ÐµÐ³Ð¾
      if (interaction.options.getUser('ÑŽÐ·ÐµÑ€')) {
        targetUser = interaction.options.getUser('ÑŽÐ·ÐµÑ€');
      } else {
        // Ð˜Ð½Ð°Ñ‡Ðµ Ð²Ñ‹Ð±Ð¸Ñ€Ð°ÐµÐ¼ Ñ€Ð°Ð½Ð´Ð¾Ð¼Ð½Ð¾Ð³Ð¾ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ Ð½Ð° ÑÐµÑ€Ð²ÐµÑ€Ðµ
        const members = await interaction.guild.members.fetch({ limit: 100 });
        const nonBotMembers = members.filter(m => !m.user.bot);
        if (nonBotMembers.size === 0) {
          return await interaction.reply('ðŸ˜… ÐÐ° ÑÐµÑ€Ð²ÐµÑ€Ðµ Ð½ÐµÑ‚ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹!');
        }
        const randomMember = nonBotMembers.random();
        targetUser = randomMember.user;
      }

      const userName = targetUser.toString(); // @User
      const event = getRandomEvent(userName);

      await interaction.reply(event);
    } catch (error) {
      console.error('[RANDOM ACTION] Error:', error);
      await interaction.reply('âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ð¸ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹!').catch(() => null);
    }
  }
};
